chrome.runtime.onMessage.addListener(((e,t,r)=>{"teacherList"===e.type&&async function(e,t){e=[...new Set(e)];let r=[];for(let a=0;a<e.length;a++){let n=e[a];console.log("Fetching data for teacher:",n);const s={text:n};try{const e=await fetch("https://v0-proxy-server-git-main-adeebismails-projects.vercel.app/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:'\n    query NewSearch($text: String!) {\n      newSearch {\n        teachers(query: { text: $text, schoolID: "U2Nob29sLTEwMDM=" }) {\n          edges {\n            cursor\n            node {\n              id\n              firstName\n              lastName\n              avgDifficulty\n              avgRating\n              department\n              legacyId\n              numRatings\n              wouldTakeAgainPercent\n              courseCodes {\n                        courseName\n                }\n            }\n          }\n        }\n      }\n    }\n  ',variables:s})});let a=(await e.json()).data.newSearch.teachers.edges;for(let e=0;e<a.length;e++){console.log(a[e].node),courses=a[e].node.courseCodes;for(let n=0;n<courses.length;n++)if(courses[n].courseName.startsWith(t)||courses[n].courseName.startsWith(t.toUpperCase())||courses[n].courseName.startsWith(t.toLowerCase())){r.push(a[e]);break}}}catch(e){console.error("GraphQL Error:",e)}}return r}(e.data,e.departmentCode).then((e=>{chrome.tabs.query({active:!0,currentWindow:!0},(t=>{chrome.tabs.sendMessage(t[0].id,{type:"teacherData",data:e})}))}))})),chrome.webNavigation.onHistoryStateUpdated.addListener((e=>{e.url.includes("courses")&&chrome.scripting.executeScript({target:{tabId:e.tabId},files:["src/content.js"]})}),{url:[{hostContains:"tamu.collegescheduler.com"}]});